- 生产者如何保证消息成功发送到服务端？

  生产者需要开启confirm模式，此时，发送的每一条消息，都会指派一个唯一的Id。当消息在服务端落盘成功后，服务端会根据这个Id返回一个ACK给生产者。如果服务端发生异常，则返回一个一个NACK给生产者。生产者要做好在发送异常时的重试。

  

- 如何确保消费者成功消费消息？

  消费者需要开启confirm模式，只有消费者确认的消息，服务端才会将对应的消息删除。如果消费者接收到消息，但还未确认，此时发生宕机，服务端会将该消息转发给同级的消费者。

  

- 如何避免消息重复投递或者重复消费？

  生产者生产消息时，MQ会根据每条消息，生成一个inner-msg-id，作为去重和幂等的依据，避免重复的消息落盘

  rabbitmq没有offset等概念，所以无法识别每条消息的位置，所以消费者消费消息时，需要上游在消息体中，携带一个唯一的Id，作为去重和幂等的依据

  

- 如何保证消息的顺序性？

  多个消费者往一个队列发送消息，那消息的顺序性肯定无法保障。每个消费者对应一个队列，消费者单线程往队列中发送消息。

  

- RabbitMQ如何保证消息不丢失？

  //todo重新组织语言

  

- 消费者消费能力差异较大怎么办？

  消费者开启Qos，rabbitmq服务端会进行不公平的分发

  

- Qos的意义是什么？

  相当于消费者的缓冲区，预先缓存一定的消息，消费者可以直接从缓冲区中获取下一条消息

  

- 什么情况下，消息会进入死信队列？

  消息过期，队列满了，消息被拒绝

  

- 死信队列有哪些应用场景？

  保障数据安全，当消费异常时，可以将消息放入死信队列，后续可以消费死信队列的数据，进行恢复。

  

- RabbitMQ如何实现延时消息？

  给消息设置过期时间，达到时间未消费则放入死信队列中。消费者消费死信队列的消息。但有一个缺点，其它消息进入死信队列也会被消费。

  

- 延时消息有哪些应用场景？

  订单未支付自动取消。预定会议，在预定时间点前10分钟进行通知。

  

  

  

