- Redis有哪几种数据类型，各有什么特点和应用场景？

  - String，字符串，简单的键值对缓存，如用户id和token
  - Hash，含有键值对的散列表，存储结构化的数据，如一个对象
  - List，双端链表，存储一些列表型的数据，如好友列表
  - Set，无序列表，值唯一，适合表示一些交集、并集的结构
  - ZSet，有序集合，可以去重和排序，如微博热点排行榜
  - bitmaps，位图，存储0、1，用来判断真假，常用于统计，如电话号码中不同号码的个数
  - hyperloglogs，HLL，类似于布隆过滤器，用来判断存不存在，真不真，假必假，用于缓存穿透
  - 地理空间，用于地图坐标存储

  

- Redis有哪些数据结构？

  - 对象头，存储key的类型、lru、引用次数、和指针等信息
  - 动态字符串，有两种扩容策略，小于1M时，采用加倍扩容，大于1M时，每次扩容1M；内存预分配，惰性释放空间。
  - 双向链表、压缩列表、字典、整数集合、跳表
  
  


- Redis为什么那么快？

  Redis单机的性能最高可达10W QPS

  - 基于内存，数据全部在内存中，内存的延时在纳秒级别
  - 数据读写单线程，当内存读写非常快时，单线程可以减少多线程带来的上下文切换和阻塞开销
  - 网络IO多线程，Redis 6.0后，比较耗时的IO读写为多线程处理
  - IO多路复用，epoll函数减少了内存拷贝和文件操作符的轮询，速度更快



- 什么是缓存击穿、穿透、雪崩，怎么处理？

  - 击穿，由于缓存热点到时失效导致用户请求直接访问数据库；分布式锁，定时更新
  - 穿透，用户恶意请求数据，例如Id为负数，不存在缓存里，也不存在数据库里；HLL，黑名单
  - 雪崩，大量缓存数据同时间失效，导致用户直接发起大量请求到数据库，产生瓶颈；集群，定时更新

  

- Redis的持久化机制是怎样的？线上如何配置？

  - RDB，redis database，内存快照。恢复速度快。
  - AOF，append of file，采用追加写的方式，将写操作记成日志。更安全，恢复更慢，文件更大。
  - 线上配置，推荐混合持久化，aof-use-rdb-preamble=yes，redis4引入。进程先将当前全量数据以 RDB 方式写入新的 AOF 文件，然后再将 AOF 重写缓冲区的增量命令以 AOF 方式写入到文件，写入完成后通知主进程将新的含有RDB 格式和 AOF 格式的 AOF 文件替换旧的的 AOF 文件

  

- Redis有哪些性能问题？

  - master不写快照，rdbSave函数会阻塞主线程的工作
  - 主从为单向链表，master->slave->slave，减少master的同步压力



- Redis的删除策略有哪些？

  - 定期删除，比如1分钟扫描一遍过期的数据，将其删除。有固定时间周期的CPU开销。
  - 定时删除，在key创建时，如果设置了过期时间，则创建一个定时器，定时删除。内存和CPU均比较友好。
  - 惰性删除，在查询时，检测到过期则删除。内存占用较多，不占用过多的CPU资源。

  

- Redis的淘汰策略有哪些？默认是哪种？

  - volatile-lru，从过期数据集中，找到最少使用的淘汰
  - volatile-ttl，从过期数据集中，找到将要过期的淘汰
  - volatile-random，从过期数据集中，选择任意数据淘汰
  - allkeys-lru，从数据集中，找到最少使用的淘汰
  - allkeys-random，从数据集中，找到任意数据淘汰
  - no-enviction，禁止驱逐，默认



- Redis有哪几种部署方式，各有什么特点和应用场景？
  - 单机，测试环境
  - 主从，一组多从，如故障时，需要人工介入，手动切换到从节点。一般不用，但却是哨兵和集群架构的基础
  - 哨兵，在主从的基础上，增加至少3个哨兵节点，客户端通过哨兵，获取最新的master节点，实现主从的切换
  - 集群，多个master形成集群，通过16384个哈希槽和CRC16算法决定key落到哪个槽中。集群的每个节点都负责一定量的哈希槽。每个master节点为了保障可用性，都需要有从节点，如主从架构



- Redis主从数据同步的过程时怎样的？
  - master生成一份RDB快照，并将快照发送给slave
  - master在生成RDB快照时，会将所有新的写命令缓存在内存缓冲区中，slave保存了RDB后，再将新的写命令同步给slave
  - slave在收到RDB后，清空自己的旧数据，然后加载新的RDB
  - slave在接收到后续的写日志时，会将命令写入到AOF中
  - 如果RDB在传输过程中断连，master和slave在重连后，会进行断点续传




- Redis在什么情况下会发生数据丢失？
  - 仅开启了RDB，部分新数据未及时写到快照中，此时发生宕机则数据丢失。
  - 哨兵架构，master数据未同步给slave，master宕机，哨兵将从节点升级为master。此时master未同步给slave的数据将丢失。master可以配置ack时间，当slave没有向master报心跳时，master拒绝新的写入请求。



- 有哪些常见的Java客户端，官方推荐用那哪种？

  官方推荐的客户端很多，以下为排名前三的客户端

  - redission，官方置顶推荐，实现了分布式操作，如分布式锁，延时队列，但是不支持事务、管道等Redis特性
  - jedis，对redis支持较为完善，操作与redis类似
  - lettuce，springboot默认使用的客户端，用于线程安全同步，异步和响应使用，支持集群，Sentinel，管道和编码器



- RedisTemplate有哪些功能？

  //todo

  

- Redis如何设置密码？

  requirepass 123456

  

- 什么是Redis哈希槽？

  redis没有使用分布式一致性哈希算法，而是使用哈希槽进行实现，使用CRC16算法对key进行散列计算，然后再对16384进行取余，计算出key对应存储的槽位，存入槽位对应的redis节点。



- Redis集群的节点最大多少？

  16384，即一个redis节点至少有一个槽位
  
  
  
- Redis集群添加节点，如何实现元数据管理？

  集群除了关注redis节点的状态之外，还更关注hash槽，当增加节点时，则把其它节点的hash槽部分移动到新节点中。当删除节点时，则把该节点的hash槽移动到其它节点上。

  

- Redis有哪些事务命令？
  
  MULTI、EXEC、DISCARD、WATCH




- 如何做内存优化？

  避免大字符串操作，尽量将对象存储到hash中



- 如何找出某些固定前缀的Key？

  - 使用keys命令，找出对应的key，但是会占用主线程，导致客户端请求阻塞
  - 使用scan命令，可以无阻塞找出key，但是可能存在重复的key，需要去重

  

- 大量Key同时过期，Redis要注意什么？

  redis定时器会清除过期的key，导致出现短暂的卡顿。可以在key的过期时间加上一个随机值，将过期时间尽可能的打散。



- 如何使用Redis实现异步队列？

  利用list双向链表的结构，在一端push数据，在另一端pop数据。当list没有数据时，可以适当sleep，减少频繁请求，或者使用block pop（blpop）。



- 如何使用redis实现延时队列？

  利用sorted set的score，将时间戳作为score，获取数据时则轮询队头数据，判断时间戳是否已经到时



- 如何使用Redis实现分布式锁？

  redis的设计思想是AP，尽量不要用Redis实现分布式锁

  - 使用setnx抢到对应的key ，并加上过期时间
  - 若在设置过期时间前发生宕机，则锁不会释放。使用lua脚本将setnx和expire合成一条命令，或者使用set的扩展命令。

  

- redis锁数据丢失怎么处理？

  redis主从、哨兵、集群，在master向slave进行数据同步时，都有可能会发生数据丢失。
  
  如果对锁有较高的一致性，则需要使用红锁。redission实现了红锁，向多个master发送写锁请求，超过一半的节点写锁成功后，才认为加锁成功。



- Redis是单线程还是多线程？

  Redis 6.0以前，socket读、解析、执行、socket写等，都是单线程处理。redis官方表示，CPU不是Redis的瓶颈，主要的限制在于网络IO的耗时。所以，在Redis6时，将Socket读写通过多个线程进行处理。但是其不是一个事件处理模型，主线程在调度多个Socket读写线程时，阻塞和轮询不够优雅。



- Redis 和Memcached有什么区别？

  - redis支持较为丰富的数据类型，memcached只支持字符串
  - redis有持久化机制，memcached没有

  

- redis内存满了会发生什么？

  - 淘汰策略为no-enviction的情况下，则拒绝写请求，读请求还是正常的
  - 如果设置了淘汰策略，则根据淘汰策略进行操作



https://developer.aliyun.com/article/821343